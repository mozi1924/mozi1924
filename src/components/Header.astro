---
import { Menu, X } from "lucide-react";
---

<header
  class="fixed top-0 w-full z-50 bg-[#111]/80 backdrop-blur-md border-b border-white/10 transition-all duration-300"
>
  <div
    class="max-w-7xl mx-auto px-6 h-16 flex items-center justify-between relative z-50 bg-[#1110]"
  >
    <a href="/" class="flex items-center gap-2 group">
      <div class="relative w-8 h-8 flex items-center justify-center">
        <img
          src="/favicon.svg"
          alt="Mozi Logo"
          class="w-8 h-8 group-hover:scale-110 transition-transform duration-300"
        />
      </div>
      <span class="font-bold text-lg tracking-tight">Mozi's website</span>
    </a>

    <nav class="hidden md:flex items-center gap-8">
      <a
        href="/"
        class="text-sm font-medium text-gray-300 hover:text-white transition-colors"
        >Home</a
      >
      <a
        href="/about"
        class="text-sm font-medium text-gray-300 hover:text-white transition-colors"
        >About</a
      >
      <a
        href="/blogs"
        class="text-sm font-medium text-gray-300 hover:text-white transition-colors"
        >Blogs</a
      >
      <a
        href="/mozi-rig"
        class="text-sm font-medium text-gray-300 hover:text-white transition-colors"
        >Mozi's Rig</a
      >
      <a
        href="/text-to-archbase4-encryption-decryption"
        class="text-sm font-medium text-gray-300 hover:text-white transition-colors"
        >Text2Arch Tool</a
      >
    </nav>

    <button
      id="mobile-menu-btn"
      class="md:hidden text-white p-2 focus:outline-none relative w-10 h-10 flex items-center justify-center"
      aria-label="Toggle menu"
    >
      <div class="relative w-6 h-6">
        <Menu
          className="w-6 h-6 absolute inset-0 transition-all duration-300 opacity-100 rotate-0 scale-100"
          id="menu-icon-open"
        />
        <X
          className="w-6 h-6 absolute inset-0 transition-all duration-300 opacity-0 -rotate-90 scale-50"
          id="menu-icon-close"
        />
      </div>
    </button>
  </div>

  <!-- Mobile Menu -->
  <div
    id="mobile-menu"
    class="md:hidden fixed top-16 left-0 w-full h-[calc(100vh-4rem)] bg-[#111] transition-all duration-500 ease-in-out transform translate-y-[-100%] opacity-0 pointer-events-none z-40 border-b border-white/10"
  >
    <nav
      class="h-full flex flex-col items-center justify-center overflow-y-auto"
    >
      <div class="flex flex-col items-center space-y-8 p-8 w-full max-w-md">
        <a
          href="/"
          class="mobile-link text-2xl font-medium text-gray-300 hover:text-white transition-colors"
          >Home</a
        >
        <a
          href="/about"
          class="mobile-link text-2xl font-medium text-gray-300 hover:text-white transition-colors"
          >About</a
        >
        <a
          href="/blogs"
          class="mobile-link text-2xl font-medium text-gray-300 hover:text-white transition-colors"
          >Blogs</a
        >
        <a
          href="/mozi-rig"
          class="mobile-link text-2xl font-medium text-gray-300 hover:text-white transition-colors"
          >Mozi's Rig</a
        >
        <a
          href="/text-to-archbase4-encryption-decryption"
          class="mobile-link text-2xl font-medium text-gray-300 hover:text-white transition-colors"
          >Text2Arch Tool</a
        >
      </div>
    </nav>
  </div>
</header>

<script>
  const setupMobileMenu = () => {
    const btn = document.getElementById("mobile-menu-btn");
    const menu = document.getElementById("mobile-menu");
    const iconOpen = document.getElementById("menu-icon-open");
    const iconClose = document.getElementById("menu-icon-close");
    const mobileLinks = document.querySelectorAll(".mobile-link");

    if (btn && menu && iconOpen && iconClose) {
      let isOpen = false;

      const toggleMenu = (forceClose = false) => {
        const shouldClose = forceClose || isOpen;
        const header = document.querySelector("header");

        if (shouldClose) {
          // Close
          menu.classList.add(
            "translate-y-[-100%]",
            "opacity-0",
            "pointer-events-none",
          );
          menu.classList.remove(
            "translate-y-0",
            "opacity-100",
            "pointer-events-auto",
          );

          // Icon state
          iconOpen.classList.remove("opacity-0", "rotate-90", "scale-50");
          iconOpen.classList.add("opacity-100", "rotate-0", "scale-100");

          iconClose.classList.remove("opacity-100", "rotate-0", "scale-100");
          iconClose.classList.add("opacity-0", "-rotate-90", "scale-50");

          // Header background state
          header?.classList.remove("bg-[#111]", "backdrop-blur-none");
          header?.classList.add("bg-[#111]/80", "backdrop-blur-md");

          document.body.style.overflow = "";
          isOpen = false;
        } else {
          // Open
          menu.classList.remove(
            "translate-y-[-100%]",
            "opacity-0",
            "pointer-events-none",
          );
          menu.classList.add(
            "translate-y-0",
            "opacity-100",
            "pointer-events-auto",
          );

          // Icon state
          iconOpen.classList.remove("opacity-100", "rotate-0", "scale-100");
          iconOpen.classList.add("opacity-0", "rotate-90", "scale-50");

          iconClose.classList.remove("opacity-0", "-rotate-90", "scale-50");
          iconClose.classList.add("opacity-100", "rotate-0", "scale-100");

          // Header background state
          header?.classList.remove("bg-[#111]/80", "backdrop-blur-md");
          header?.classList.add("bg-[#111]", "backdrop-blur-none");

          document.body.style.overflow = "hidden";
          isOpen = true;
        }
      };

      btn.onclick = (e) => {
        e.stopPropagation();
        toggleMenu();
      };

      // Close menu when clicking links
      mobileLinks.forEach((link) => {
        link.addEventListener("click", () => toggleMenu(true));
      });

      // Reset state on resize
      const handleResize = () => {
        if (window.innerWidth >= 768 && isOpen) {
          toggleMenu(true);
        }
      };
      window.addEventListener("resize", handleResize);
    }
  };

  document.addEventListener("astro:page-load", setupMobileMenu);
  // Also run on initial load if astro:page-load doesn't fire immediately (fallback)
  if (document.readyState === "complete") {
    setupMobileMenu();
  } else {
    document.addEventListener("DOMContentLoaded", setupMobileMenu);
  }
</script>
